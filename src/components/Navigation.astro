---
import Button from "./Button.astro";
import SubNavigation from "./SubNavigation.astro";

const {config} = Astro.props;
---

<header class="header relative z-10">
  <a href="#main" id="skipToMain" class="button header__skip-link [clip-path:polygon(0px_0px,_0px_0px,_0px_0px)] [clip:rect(1px_1px_1px_1px)] h-[1px] w-[1px] overflow-hidden py-[5px] px-[10px] absolute focus:[clip-path:unset] focus:[clip:unset] focus:h-auto focus:left-0 focus:overflow-visible focus:top-0 focus:w-auto">Skip to main content</a>
  <div class="header__navigation-wrapper mt-8 mx-auto mb-0 max-w-[1290px] px-[25px] py-0">
    <nav class="header__navigation flex items-center justify-between" aria-label="Main">
      <a href="/" class="header__logo flex items-center">
        <svg role="img" focusable="false" width="158" height="33" xmlns="http://www.w3.org/2000/svg">
          <title>Storyblok Home</title>
            <g fill="none" fill-rule="evenodd">
              <path fill="#FFF" d="M4 4h20v20H4z"/>
              <g fill-rule="nonzero">
                <path d="M45.404 23.093a10.75 10.75 0 01-3.354-.522 7.649 7.649 0 01-2.8-1.63l1.465-2.478a13.3 13.3 0 002.377 1.304 5.499 5.499 0 002.214.457c.52 0 .944-.098 1.237-.294.293-.163.423-.456.423-.815 0-.326-.162-.652-.553-.848a8.456 8.456 0 00-1.921-.652l-2.28-.75c-.618-.261-1.106-.522-1.497-.815a2.4 2.4 0 01-.846-.979 3.2 3.2 0 01-.26-1.304 4.242 4.242 0 011.53-3.326c.455-.391 1.041-.685 1.692-.913.652-.228 1.368-.326 2.117-.326 1.01 0 1.953.13 2.832.391.88.294 1.726.783 2.54 1.5l-1.595 2.446a10.838 10.838 0 00-2.019-1.141 4.35 4.35 0 00-1.758-.36c-.423 0-.814.066-1.107.262-.326.163-.456.456-.456.848 0 .39.163.652.488.847.326.196.977.392 1.856.62.816.206 1.62.456 2.41.75.65.26 1.172.554 1.595.848.8.59 1.243 1.55 1.172 2.543 0 1.337-.488 2.38-1.498 3.163-.976.783-2.279 1.174-4.004 1.174zm16.116-.946c-.553.229-1.204.457-1.92.653-.717.195-1.433.326-2.182.326-.521 0-.977-.065-1.433-.196a3.254 3.254 0 01-1.204-.652c-.326-.261-.586-.652-.782-1.076a4.198 4.198 0 01-.325-1.663v-7.011H51.98V9.463h1.725V5.19h4.037v4.24h2.735v3.097h-2.735v5.609c0 .424.098.75.326.978.228.163.521.26.847.26.325 0 .65-.032.944-.162.325-.098.618-.196.846-.326l.782 3.26h.032zm7.619.946a7.804 7.804 0 01-3.028-.554 6.387 6.387 0 01-3.647-3.75 7.51 7.51 0 010-5.283 6.387 6.387 0 013.647-3.75c.88-.358 1.888-.554 3.028-.554a6.832 6.832 0 015.275 2.12c.618.619 1.074 1.369 1.4 2.184a7.315 7.315 0 010 5.315A6.42 6.42 0 0172.2 22.54a7.804 7.804 0 01-3.061.554zm-2.93-6.913c0 1.044.26 1.891.814 2.511.586.652 1.302.978 2.149.978a2.668 2.668 0 002.116-.978c.26-.326.456-.652.619-1.109.162-.424.227-.913.227-1.402 0-1.076-.293-1.924-.846-2.543a2.668 2.668 0 00-2.116-.979 2.766 2.766 0 00-2.117.979c-.26.326-.488.652-.65 1.108a4.245 4.245 0 00-.196 1.435zm20.61-3.228c-.977 0-1.889.163-2.703.489a3.257 3.257 0 00-1.726 1.37v8.054h-4.07V9.463h3.745v2.674c.456-.913 1.042-1.63 1.79-2.12.717-.522 1.466-.783 2.28-.815h.423l.26.032v3.718zm1.79 11.902a5.918 5.918 0 001.758.326c.489 0 .88-.163 1.173-.49.26-.325.488-.977.716-1.825l-5.08-13.402h4.2l3.094 9.88 2.702-9.88h3.81L95.87 25.017a5.306 5.306 0 01-6.186 3.652 5.002 5.002 0 01-1.075-.326v-3.489zm22.01-1.76c-1.01 0-1.92-.197-2.67-.653a4.724 4.724 0 01-1.823-1.794v2.218h-3.549V4.213h4.102v7.435a4.85 4.85 0 014.363-2.446c.847 0 1.628.163 2.345.554.716.326 1.302.848 1.855 1.468a8.554 8.554 0 011.173 7.695 7.19 7.19 0 01-1.335 2.218 5.987 5.987 0 01-4.461 1.956zm-1.14-3.425a3.093 3.093 0 002.93-2.087 4.048 4.048 0 00-.618-3.88 2.636 2.636 0 00-2.149-1.044c-.618 0-1.204.229-1.758.653a4.667 4.667 0 00-1.237 1.695v2.805a3.19 3.19 0 002.865 1.826l-.033.032zm9.377-15.456h4.07V18.07c0 1.044.424 1.533 1.303 1.533.464.001.923-.11 1.335-.326l.553 3.033a9.3 9.3 0 01-3.614.782c-1.172 0-2.084-.326-2.702-.913-.652-.652-.977-1.5-.977-2.674V4.213h.032zm14.945 18.88a7.804 7.804 0 01-3.028-.554 6.42 6.42 0 01-3.68-3.75 7.509 7.509 0 011.368-7.5 7.015 7.015 0 012.28-1.533c.878-.358 1.888-.554 3.027-.554a6.832 6.832 0 015.275 2.12c.651.619 1.074 1.369 1.4 2.184a7.346 7.346 0 01-1.368 7.5 6.25 6.25 0 01-2.279 1.533 7.804 7.804 0 01-3.028.554h.033zm-2.963-6.913c0 1.044.26 1.891.814 2.511.586.652 1.302.978 2.149.978a2.7 2.7 0 002.116-.978c.26-.326.456-.652.619-1.109.163-.424.228-.913.228-1.402 0-1.076-.293-1.924-.847-2.543a2.668 2.668 0 00-2.116-.979 2.766 2.766 0 00-2.116.979c-.26.326-.489.652-.652 1.108-.162.457-.195.913-.195 1.435zm21.13 6.685l-3.483-5.413-1.433 1.5v3.913h-4.07V4.213h4.07v10.793l4.526-5.543h4.33l-4.818 5.771 5.21 7.63h-4.331z" fill="#141A2F"/>
                <g fill="#0AB3AF">
                  <path d="M16.278 15.213H9.813v3.042h6.31c.373 0 .715-.152.995-.395.248-.244.404-.609.404-1.065a1.798 1.798 0 00-.342-1.095c-.249-.305-.529-.487-.902-.487zm.218-3.682c.28-.182.404-.578.404-1.095 0-.456-.124-.791-.342-1.004a1.258 1.258 0 00-.808-.304H9.812v2.738h5.814c.31 0 .621-.152.87-.335z"/>
                  <path d="M26.777 0H1.452C.645 0 0 .643 0 1.415v25.28c0 .773.645 1.255 1.42 1.255h3.742V33l4.646-5.018h16.97c.774 0 1.258-.482 1.258-1.286V1.447c0-.772-.484-1.415-1.29-1.415L26.776 0zM22.52 20.488a3.893 3.893 0 01-1.387 1.416c-.613.385-1.29.74-2.065.9-.774.193-1.613.354-2.484.354H5.162V5.146h12.97c.645 0 1.193.129 1.71.418.483.258.935.611 1.29 1.03a4.815 4.815 0 011.097 3.12c0 .836-.226 1.64-.646 2.412a4.028 4.028 0 01-1.935 1.737c1.032.289 1.839.804 2.451 1.543.581.772.872 1.77.872 3.024 0 .804-.162 1.48-.484 2.058h.032z"/>
                </g>
              </g>
            </g>
        </svg>
      </a>

      <div class="header__main hidden min-[1100px]:block">
        <ul class="header__nav m-0 p-0 indent-0 list-none flex flex-wrap justify-between items-center">
          {config.content.new_header.map((header_item: any, index:number) => {
            return <li class='relative my-0 mx-[2px] min-[1260px]:mx-[10px]'>
             {header_item.component == 'navigation_item' ? <a class="header__nav-item appearance-none bg-transparent block border-none cursor-pointer m-0 p-[10px]  text-secondary hover:text-primary" title={`Navigate to ${header_item.display}`} href={`${header_item.link.cached_url}`}>
                  {header_item.display}
                </a> : <button
                  class="header__nav-item appearance-none bg-transparent block border-none cursor-pointer m-0 p-[10px] text-secondary hover:text-primary aria-expanded:text-primary"
                  title={`Open subnavigation for ${header_item.display}`}
                  aria-expanded="false"
                  aria-controls={`submenu_${index + 1}`}
                >
                  {header_item.display}
                  <svg class='mb-[2px] inline' width="9" height="5" aria-hidden="true" version="1.1" viewBox="0 0 8 5" xmlns="http://www.w3.org/2000/svg">
                    <g fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><g transform="translate(-705 -23)" stroke="currentColor" stroke-width="2"><polyline points="706 24 709 27 712 24"/></g></g>
                  </svg>
                </button>
                <SubNavigation menu={header_item} id={`submenu_${index + 1}`} />
              }
             </li>
          })}
        </ul>
      </div>

      <div class="header__right hidden min-[1100px]:block">
        <ul class="header__nav  m-0 p-0 indent-0 list-none flex flex-wrap justify-between items-center">
          <li>
            <a
              href="/search"
              class="header__nav-item header__search appearance-none bg-transparent border-none cursor-pointer m-0 p-[10px] text-secondary hover:text-primary flex items-center rounded-[5px] h-[47px] justify-center relative top-[2px] transition-all w-[47px] hover:bg-[#f0f2f6]"
              title="Open Website Search"
            >
              <svg class="icon w-[22px] h-[22px] mb-0 inline-block stroke-current fill-current">
                <use xlink:href="#search-icon"></use>
              </svg>
            </a>
          </li>
          <li>
            <a
              href="https://app.storyblok.com/#!/"
              title="Navigate to login page"
              class="header__nav-item header__login appearance-none bg-transparent block border-none cursor-pointer m-0 p-[10px] text-secondary hover:text-primary"
              >Login</a
            >
          </li>
          <li>
            <a
              href="https://app.storyblok.com/#!/signup"
              target="_blank"
              rel="noreferrer noopener"
              class="header__nav-item appearance-none bg-transparent block border-none cursor-pointer m-0 p-[10px] text-secondary hover:text-primary"
              >Signup</a
            >
          </li>
          <li>
            <Button class="button header__signup" style='py-[9px] px-[40px] mt-0 mr-0' href="/fs/enterprise-contact">Contact Sales</Button>
          </li>
        </ul>
      </div>

      <div class="header__mobile block min-[1100px]:hidden">
        <button class="header__nav-item appearance-none bg-transparent block border-none cursor-pointer m-0 p-[10px]" id="mobile-nav" title="Open navigation" aria-expanded="false">
          <span class="sr-only">Open Navigation</span>
          <svg class='mb-0'
            aria-hidden="true"
            focusable="false"
            width="19"
            height="17"
            viewBox="0 0 19 17"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g transform="translate(0 .1)" fill="#1b253e" fill-rule="evenodd">
              <rect y=".6" width="19" height="2" rx="1"/>
              <rect y="7.6" width="12" height="2" rx="1"/>
              <rect y="14.6" width="19" height="2" rx="1"/>
            </g>
          </svg>
        </button>
      </div>
    </nav>
  </div>
</header>

<script>
  document.querySelectorAll(".header__nav-item").forEach((navItem) => {
      navItem.addEventListener("click", () => {
        navItem.classList.toggle("header__nav-item--open");
        if (navItem.tagName === "BUTTON") {
          // this.segmentTrack("header_click", {
          //   header_text: navItem.innerText,
          // });

          if (navItem.getAttribute("aria-expanded") === "false") {
            navItem.setAttribute("aria-expanded", "true");
            navItem.nextElementSibling?.setAttribute("aria-hidden", "false");
          } else if (navItem.getAttribute("aria-expanded") === "true") {
            navItem.setAttribute("aria-expanded", "false");
            navItem.nextElementSibling?.setAttribute("aria-hidden", "true");
          }
        }
      });
    });
    document.querySelectorAll(".sub-nav a").forEach((linkItem: any) => {
      linkItem.addEventListener("click", () => {
        let linkText = linkItem.innerText;
        try {
          if (linkItem.querySelector(".sub-nav__item-h")) {
            linkText = linkItem.querySelector(".sub-nav__item-h").innerText;
          } else if (
            linkItem.classList.contains("sub-nav-images-links__item-link") &&
            linkItem.querySelector(".sub-nav-images-links__item-image")
          ) {
            linkText = linkItem.querySelector(
              ".sub-nav-images-links__item-image"
            ).alt;
          }
        } catch (e) {
          console.log("Issue while trying to fetch the link name");
        }
        // this.segmentTrack("header_dpd_click", {
        //   link_text: linkText,
        //   link_url: linkItem.href,
        // });
      });
    });
    window.addEventListener("click", (e: any) => {
      let navItems = document.querySelectorAll(".header__nav-item");
      navItems.forEach((navItem) => {
        if (!navItem.contains(e.target)) {
          navItem.classList.remove("header__nav-item--open");
          if (navItem.getAttribute("aria-expanded") === "true") {
            navItem.setAttribute("aria-expanded", "false");
            navItem.nextElementSibling?.setAttribute("aria-hidden", "true");
          }
        }
      });
    });
</script>